@page "/"
@page "/home"
@using Humanizer
@using MemeChat.Database.Interfaces
@using MemeChat.ViewModel


<MudAppBar Elevation="1" Fixed="true" Dense="true">
    <MudText Align="Align.Left" Typo="Typo.h5" Class="user-select-none">MemeChat</MudText>
    <MudSpacer />
    <MudIconButton Icon="@Icons.Filled.PersonAddAlt1" Color="Color.Inherit" OnClick="AddNewContact" />
    <MudIconButton Icon="@Icons.Filled.Settings" Color="Color.Inherit" Link="account" />
</MudAppBar>

<MudMainContent>
    <MudContainer MaxWidth="MaxWidth.Large">
        <MudTextField @bind-Value="IndexViewModel.SearchName"
                      Placeholder="Search..."
                      AdornmentIcon="@Icons.Filled.Search"
                      Adornment="Adornment.End"
                      DebounceInterval="250" />

        <MudGrid>
            <MudVirtualize IsEnabled="true" Items="IndexViewModel.Users" Context="user">
                <MudItem xs="4">
                    <MudAvatar Image="@user.Avatar" />
                </MudItem>
                <MudItem xs="8">
                    <MudText Typo="Typo.subtitle2">@user.Name</MudText>
                    <MudText Typo="Typo.body2">@IndexViewModel.Chats[user.Nickname].Messages.Last().SendAt.Humanize()</MudText>
                </MudItem>
            </MudVirtualize>
        </MudGrid>
    </MudContainer>
</MudMainContent>

@code {
    [Inject] public IDialogService DialogService { get; set; }
    [Inject] public IndexViewModel IndexViewModel { get; set; }

    private bool isVisible;

    protected override async Task OnInitializedAsync()
    {
        await IndexViewModel.LoadData();
    }

    private void AddNewContact()
    {
    }
}